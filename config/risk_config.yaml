# Risk Engine Configuration

# Redis connection for portfolio state
redis_host: "localhost"
redis_port: 6379
redis_db: 0
redis_positions_key: "robinhood:positions"

# TimescaleDB connection for historical data
timescale_host: "localhost"
timescale_port: 5432
timescale_db: "market_data"
timescale_user: "postgres"
timescale_password: ""

# Position Sizing Configuration
position_sizing:
  method: "atr"                    # "atr" or "kelly"
  risk_per_trade_pct: 0.015        # 1.5% risk per trade (tighter for sub-$2k accounts)
  atr_multiplier: 2.0              # Stop distance = ATR * multiplier
  max_position_pct: 0.15           # Maximum 15% of portfolio per position (tighter for sub-$2k)
  kelly_fraction: 0.25             # Fractional Kelly (25% of optimal)

# Portfolio Risk Limits
portfolio_risk:
  max_concentration_pct: 0.15      # Max 15% in any single position (matches max_position_pct)
  max_correlation: 0.80            # Reject if correlation > 80% with existing
  max_total_exposure_pct: 0.95     # Keep at least 5% cash
  min_cash_pct: 0.05               # Minimum cash buffer
  max_open_positions: 5            # Max concurrent open positions
  max_sector_exposure_pct: 0.40    # Max 40% of portfolio in any one sector
  drawdown_threshold_pct: 0.10     # 10% drawdown from peak triggers size reduction
  drawdown_size_reduction: 0.50    # Halve position sizes when in drawdown

# Sector Groups — symbols grouped by correlated sector
# Used for sector concentration limits
sector_groups:
  uranium:
    - CCJ
    - URNM
    - UUUU
  precious_metals:
    - WPM
    - SLV
    - IAUM
    - PPLT
  industrial:
    - CAT
  rare_earth:
    - MP

# Value at Risk Configuration
var:
  enabled: false                     # Disabled until account > $10k — assumes stationary returns, crude fallback
  confidence: 0.95                 # 95% confidence level
  max_var_daily_pct: 0.05          # Max 5% daily VaR
  max_cvar_daily_pct: 0.08         # Max 8% daily CVaR
  lookback_days: 252               # 1 year of trading days

# Trade-Level Risk Checks
trade_risk:
  max_atr_pct: 0.05                # Reject if ATR > 5% of price
  require_above_sma200: true       # BUY only above 200 SMA
  min_volume_pct: 0.50             # Minimum 50% of average volume

# Symbol-Specific Overrides
symbol_overrides:
  MP:
    max_position_pct: 0.15         # High volatility - smaller position
    max_atr_pct: 0.08              # Allow higher volatility
  IAUM:
    max_position_pct: 0.25         # Stable ETF - larger position allowed
    require_above_sma200: false    # Skip trend filter for gold ETF
  SPY:
    max_position_pct: 0.30         # Index ETF - larger position allowed
    max_atr_pct: 0.03              # Tighter volatility for index

# Logging
log_level: "INFO"
